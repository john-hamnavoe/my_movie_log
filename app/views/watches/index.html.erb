<% provide(:title, 'movies watched') %>
<% last_month = 0 %>
<% last_year = 0 %>
<% group_started = false %>
<% @watches.each do |watch| %>
  <% if last_month != watch.date.month || last_year != watch.date.year %>
    <% if group_started %>
      </div>
      </ol>
    <% end %>
    
    <h1 class="h3"><%= "#{watch.date.strftime('%b')} - #{watch.date.year}" %></h1>
    <% last_month = watch.date.month %>
    <% last_year = watch.date.year %>
    <% group_started = true %>
    <ol class="list-group">
      <div class="row">
  <% end %>
  <div class="col-sm-6">
    <li class="list-group-item clearfix">
        <div class="row">
      	<div class="col-sm-2">
      	   <%= poster_for_path watch.movie.tmdb_poster_path, watch.movie.title %>
      	</div>
        <div class="col-sm-10">
          <h4 class="h4"><%= link_to watch.movie.title, movie_path(id: watch.movie.id, watched: true) %></h4>
          <div class="row">
            <div class="col-sm-6"><h4 class="h5"><%= "watched on #{watch.date}" %></h4></div>            
            <div class="col-sm-6"><h4 class="h5 pull-right"><%= "your rating: #{watch.rating}" %></h4></div>
          </div>
          <hr style="margin-bottom: 0.5em;">
          <span class="pull-left">
            <%= link_to "<button type=\"button\"><i class=\"fa fa-pencil-square-o\"></i></button>".html_safe, edit_watch_path(watch.id)%>
          </span>
          <span class="pull-right">
            <%= link_to "<button type=\"button\"><i class=\"fa fa-trash\"></i></button>".html_safe,
              watch_path(watch.id), method: :delete, data: { confirm: "You sure?" } %>
          </span>          
        </div>   
        </div>
    </li>
  </div>
<% end %>
<% if group_started %>
  </div>
  </ol>
<% end %>  

<%= will_paginate @watches %>